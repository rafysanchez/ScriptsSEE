function acaoGrid(n){$.ajax({async:!1,cache:!1,url:"/Ocorrencia/Detalhe",type:"POST",datatype:"html",data:{id:parseInt(n)},success:function(n){$("#dialogDetalhe").html(n);$("#dialogDetalhe").dialog({position:"top",width:820,resizable:!1,modal:!0,dragable:!1,show:{effect:"blind",duration:200},beforeClose:function(){CodigoPerfil=$("#hdfCodigoPerfil").val();$("#CodigoEscola").val()!=undefined&&PesquisarOcorrencias()}});$("#tabelaDados").sedDataTable({sScrollX:"120%",sScrollXInner:"140%"})},error:function(n,t,i){$(document).ajaxStop(function(){Mensagem.Alert({titulo:"Erro",mensagem:"Ocorreu um erro durante o processo: "+i,tipo:"Erro",botao:"Fechar"})})}})}function ConsultaEscolaPorAnoLetivo(n,t){if(($(t).html(""),$(t).append('<option value="">Selecione...<\/option>'),$(n).val()!=undefined)&&!($(n).val().length<4)){var i=TratarValorNumerico($(n).val());$.ajax({cache:!1,url:"/Ocorrencia/ConsultarEscolaPorAnoLetivo",type:"POST",datatype:"JSON",data:{anoLetivo:parseInt(i)},success:function(n){for(var i=0;i<n.length;i++)$(t).append('<option value="'+n[i].CD_ESCOLA+'">'+n[i].NOME_ESCOLA+"<\/option>")},error:function(n,t,i){$(document).ajaxStop(function(){Mensagem.Alert({titulo:"Erro",mensagem:"Ocorreu um erro durante o processo: "+i,tipo:"Erro",botao:"Fechar"})})}})}}function AbrirOcorrenciaAluno(n,t,i){$.ajax({url:"/Ocorrencia/OcorrenciaAluno",data:{anoLetivo:n,codigoAluno:t,codigoTurma:i},success:function(n){$("#index").hide();$("#ocorrenciaAluno").empty().html(n);$("#dadosOcorrencia #tabelaDadosAlunos").sedDataTable({sScrollX:"100%",sScrollXInner:"120%"})}})}var textoAnterior="",AtualizarInformacaoAluno,AutoCompletarEscolaPorAnoLetivo;$().ready(function(){$(document).ready(function(){$("#txtAnoLetivo").keypress(function(n){if(n.which!=8&&n.which!=0&&(n.which<48||n.which>57))return!1})});$(".formCadastro").validate({rules:{CodigoDiretoria:{required:!0},CodigoEscola:{required:!0},DataOcorrencia:{required:!0,dataValida:!0},CodigoTipoOcorrencia:{required:!0},DescricaoOcorrencia:{required:!0},CodigoPerfilLimite:{required:!0}},messages:{CodigoDiretoria:{required:"Obrigatório"},CodigoEscola:{required:"Obrigatório"},DataOcorrencia:{required:"Obrigatório",dataValida:"Data inválida"},CodigoTipoOcorrencia:{required:"Obrigatório"},DescricaoOcorrencia:{required:"Obrigatório"},CodigoPerfilLimite:{required:"Obrigatório"}}});$("#CodigoDiretoria").change(function(){$("#CodigoEscola").trigger("change")});$("#CodigoEscola").change(function(){BloquarCamposCadastroAluno(this)});$("#CodigoDiretoriaFiltro").change(function(){$("#CodigoEscolaFiltro").trigger("change")});$("#CodigoEscolaFiltro").change(function(){BloquarCamposCadastroAluno(this)});$("#btnCadastrarOcorrencia").click(function(n){if(n.preventDefault(),$(".formCadastro").valid()!=!1){if($("#tabelaDados tbody tr").length==undefined){Mensagem.Alert({mensagem:"Nenhum aluno informado.",tipo:"Aviso",botao:"Fechar"});n.preventDefault();return}if($("#tabelaDados tbody tr").length<=0){Mensagem.Alert({mensagem:"Nenhum aluno informado.",tipo:"Aviso",botao:"Fechar"});n.preventDefault();return}CadastrarOcorrencia()}});AutoCompeltarAluno()});var TratarValorNumerico=function(n){return n==undefined?0:n==""?0:isNaN(n)?0:parseInt(n)},BloquarCamposCadastroAluno=function(n){if($(n).val()==""){$(".camposBloqueioEscola").each(function(){$(this).attr("disabled","disabled")});$(".camposBloqueioDiretoria").each(function(){$(this).removeAttr("disabled","disabled")});$(".avisoDiretoria").attr("hidden","hidden");$(".avisoEscola").removeAttr("hidden","hidden");return}if(parseInt($(n).val())<=0){$(".camposBloqueioEscola").each(function(){$(this).attr("disabled","disabled")});$(".camposBloqueioDiretoria").each(function(){$(this).removeAttr("disabled","disabled")});$(".avisoDiretoria").attr("hidden","hidden");$(".avisoEscola").removeAttr("hidden","hidden");return}var t=$("#tabelaDados tbody tr");if(t.length>0){$(".camposBloqueioEscola").each(function(){$(this).removeAttr("disabled","disabled")});$(".camposBloqueioDiretoria").each(function(){$(this).attr("disabled","disabled")});$(".avisoDiretoria").removeAttr("hidden","hidden");$(".avisoEscola").attr("hidden","hidden");return}$(".camposBloqueioEscola").each(function(){$(this).removeAttr("disabled","disabled")});$(".camposBloqueioDiretoria").each(function(){$(this).removeAttr("disabled","disabled")});$(".avisoDiretoria").attr("hidden","hidden");$(".avisoEscola").attr("hidden","hidden")},AutoCompeltarAluno=function(){$("#btnAdicionarAluno").click(function(){AdicionarAluno()});$("#txtNomeAlunoFiltro").autocomplete({source:function(n,t){$.ajax({url:"/Ocorrencia/ConsultarAlunosAutoCompletar",dataType:"json",global:!1,cache:!0,async:!0,data:{dataOcorrencia:$("#DataOcorrencia").val(),codigoEscola:parseInt($("#CodigoEscolaFiltro").val()==undefined?$("#CodigoEscola").val():$("#CodigoEscolaFiltro").val()),nomeAluno:$("#txtNomeAlunoFiltro").val(),nrRA:parseInt($("#txtRaAlunoFiltro").val())},success:function(n){t($.map(n,function(n){return{label:n.NomeAluno,value:n.NomeAluno,id:n.CodigoAluno,nrRA:n.nrRA,nrDigRa:n.nrDigRa,sgUfRa:n.sgUfRa}}))}})},minLength:4,select:function(n,t){$('input[name="txtNomeAlunoFiltro"]').val(t.item.label);$('input[name="hdnCodigoAluno"]').val(t.item.id);$('input[name="txtRaAlunoFiltro"]').val(t.item.nrRA);$('input[name="txtDigRaFiltro"]').val(t.item.nrDigRa);$('input[name="txtUfRaFiltro"]').val(t.item.sgUfRa);$.ajax({url:"/Ocorrencia/ConsultarTurmaAluno",dataType:"json",global:!1,cache:!0,async:!0,data:{codigoEscola:parseInt($("#CodigoEscolaFiltro").val()==undefined?$("#CodigoEscola").val():$("#CodigoEscolaFiltro").val()),codigoAluno:parseInt(t.item.id)},success:function(n){$("#ddlTurmaAluno").html("");n.length>1&&$("#ddlTurmaAluno").append('<option value="">Selecione...<\/option>');for(var t=0;t<n.length;t++)$("#ddlTurmaAluno").append('<option value="'+n[t].CD_TURMA+'">'+n[t].DS_TURMA+"<\/option>")}})},search:function(){$('input[name="hdnCodigoAluno"]').val("");$('input[name="txtRaAlunoFiltro"]').val("");$('input[name="txtDigRaFiltro"]').val("");$('input[name="txtUfRaFiltro"]').val("");$("#ddlTurmaAluno").html("")}});$("#txtRaAlunoFiltro").autocomplete({source:function(n,t){$.ajax({url:"/Ocorrencia/ConsultarAlunosAutoCompletar",dataType:"json",global:!1,cache:!0,async:!0,data:{dataOcorrencia:$("#DataOcorrencia").val(),codigoEscola:parseInt($("#CodigoEscolaFiltro").val()==undefined?$("#CodigoEscola").val():$("#CodigoEscolaFiltro").val()),nomeAluno:$("#txtNomeAlunoFiltro").val(),nrRA:parseInt($("#txtRaAlunoFiltro").val())},success:function(n){t($.map(n,function(n){return{label:n.nrRA,value:n.nrRA,id:n.CodigoAluno,nomeAluno:n.NomeAluno,nrDigRa:n.nrDigRa,sgUfRa:n.sgUfRa}}))}})},minLength:4,select:function(n,t){$('input[name="txtNomeAlunoFiltro"]').val(t.item.nomeAluno);$('input[name="hdnCodigoAluno"]').val(t.item.id);$('input[name="txtRaAlunoFiltro"]').val(t.item.label);$('input[name="txtDigRaFiltro"]').val(t.item.nrDigRa);$('input[name="txtUfRaFiltro"]').val(t.item.sgUfRa);$.ajax({url:"/Ocorrencia/ConsultarTurmaAluno",dataType:"json",global:!1,cache:!0,async:!0,data:{codigoEscola:parseInt($("#CodigoEscolaFiltro").val()==undefined?$("#CodigoEscola").val():$("#CodigoEscolaFiltro").val()),codigoAluno:parseInt(t.item.id)},success:function(n){$("#ddlTurmaAluno").html("");n.length>1&&$("#ddlTurmaAluno").append('<option value="">Selecione...<\/option>');for(var t=0;t<n.length;t++)$("#ddlTurmaAluno").append('<option value="'+n[t].CD_TURMA+'">'+n[t].DS_TURMA+"<\/option>")}})},search:function(){$('input[name="hdnCodigoAluno"]').val("");$('input[name="txtNomeAlunoFiltro"]').val("");$('input[name="txtDigRaFiltro"]').val("");$('input[name="txtUfRaFiltro"]').val("")}})},AdicionarAluno=function(){var n,t,i,r;if($("#hdnCodigoAluno").val()==""||$("#ddlTurmaAluno").val()==null||$("#ddlTurmaAluno").val()==""){Mensagem.Alert({titulo:"Aviso",mensagem:"Informe o Aluno e Turma.",tipo:"Aviso",botao:"Fechar"});return}TratarValorNumerico($("#hdnCodigoAluno").val())<=0||(n=$("#tabelaDados tbody tr"),t=n.length,n.length>0&&t++,i=new Array(t),existe=!1,r=$("#hdnCodigoAluno").val(),$(n).each(function(n){codigoAluno=$(this).find('input[name="hdfCodigoAluno"]').val();codigoTurma=$(this).find('input[name="hdfCodigoTurma"]').val();codigoAluno!=r||existe||(existe=!0);i[n]=codigoAluno+"|"+codigoTurma}),existe?Mensagem.Alert({titulo:"Aviso",mensagem:"Aluno já informado.",tipo:"Aviso",botao:"Fechar"}):i[t]=$("#hdnCodigoAluno").val()+"|"+$("#ddlTurmaAluno").val(),setTimeout(function(){$.ajax({cache:!1,url:"/Ocorrencia/AdicionarAlunoParcial",type:"POST",datatype:"html",data:{dadosAlunoTurma:i},traditional:!0,success:function(n){$(".alunosSelecionados").html(n);$("#tabelaDados").sedDataTable();BloquarCamposCadastroAluno()},error:function(n,t,i){$(document).ajaxStop(function(){Mensagem.Alert({titulo:"Erro",mensagem:"Ocorreu um erro durante o processo: "+i,tipo:"Erro",botao:"Fechar"})})}});$("#txtNomeAlunoFiltro").val("");$("#txtRaAlunoFiltro").val("");$("#txtDigRaFiltro").val("");$("#txtUfRaFiltro").val("");$("#ddlTurmaAluno").html("")},1500))},ExcluirAluno=function(n){n=n.toString();var t=$("#tabelaDados tbody tr"),r=t.length,i=new Array(r);$(t).each(function(t){codigoAlunoGrid=$(this).find('input[name="hdfCodigoAluno"]').val();codigoTurmaGrid=$(this).find('input[name="hdfCodigoTurma"]').val();codigoAlunoGrid!=n&&(i[t]=codigoAlunoGrid+"|"+codigoTurmaGrid)});$.ajax({cache:!1,url:"/Ocorrencia/AdicionarAlunoParcial",type:"POST",datatype:"html",data:{dadosAlunoTurma:i},traditional:!0,success:function(n){$(".alunosSelecionados").html(n);$("#tabelaDados").sedDataTable();BloquarCamposCadastroAluno()},error:function(n,t,i){$(document).ajaxStop(function(){Mensagem.Alert({titulo:"Erro",mensagem:"Ocorreu um erro durante o processo: "+i,tipo:"Erro",botao:"Fechar"})})}})},CadastrarOcorrencia=function(){var t=$("#tabelaDados tbody tr"),i=new Array(t.length),n;$(t).each(function(n){codigoAlunoGrid=$(this).find('input[name="hdfCodigoAluno"]').val();codigoTurmaGrid=$(this).find('input[name="hdfCodigoTurma"]').val();i[n]=codigoAlunoGrid+"|"+codigoTurmaGrid});n=0;n=$("#CodigoEscola").val()!=undefined?$("#CodigoEscola").val():$("#CodigoEscolaFiltro").val();$.ajax({cache:!1,url:"/Ocorrencia/InserirOcorrencia",type:"POST",datatype:"json",data:{codigoEscola:TratarValorNumerico(n),cpfProfessor:$("#CpfProfessor").val(),dataOcorrencia:$("#DataOcorrencia").val(),codigoTipoOcorrencia:TratarValorNumerico($("#CodigoTipoOcorrencia").val()),descricaoOcorrencia:$("#DescricaoOcorrencia").val(),codigoAbrangencia:TratarValorNumerico($("#CodigoPerfilLimite").val()),listaAluno:i},traditional:!0,success:function(){window.location.href="/Ocorrencia/Cadastro"},error:function(n,t,i){$(document).ajaxStop(function(){Mensagem.Alert({titulo:"Erro",mensagem:"Ocorreu um erro durante o processo: "+i,tipo:"Erro",botao:"Fechar"})})}})},DetalharOcorrencia=function(n){$.ajax({async:!1,cache:!1,url:"/Ocorrencia/Detalhe",type:"POST",datatype:"html",data:{id:parseInt(n)},success:function(n){$("#dialogDetalhe").html(n);$("#tabelaDados").sedDataTable()},error:function(n,t,i){$(document).ajaxStop(function(){Mensagem.Alert({titulo:"Erro",mensagem:"Ocorreu um erro durante o processo: "+i,tipo:"Erro",botao:"Fechar"})})}})},Excluir=function(){var n=$("#CodigoOcorrencia").val();Mensagem.Alert({titulo:"Atenção!",mensagem:"Deseja realmente excluir a Ocorrência?",tipo:"aviso",botoes:[{botao:"Sim",callback:function(){$.ajax({type:"POST",dataType:"HTML",async:!0,data:{codigoOcorrencia:TratarValorNumerico(n)},url:"/Ocorrencia/Excluir",success:function(){$("#dialogDetalhe").dialog("close")},error:function(){Mensagem.CarregarMensagens("Fechar")}})}},{botao:"Não",callback:function(){$.unblockUI()}}]})},Editar=function(n){$.ajax({async:!1,cache:!1,url:"/Ocorrencia/Editar",type:"POST",datatype:"html",data:{id:parseInt(n)},success:function(n){$("#dialogDetalhe").html(n);$("#CpfProfessorEdt").val($("#hdfCpfProfessor").val());$("#CodigoTipoOcorrencia").val($("#hdfTipoOcorrencia").val());$("#CodigoPerfilLimite").val($("#hdfPerfil").val())},error:function(n,t,i){$(document).ajaxStop(function(){Mensagem.Alert({titulo:"Erro",mensagem:"Ocorreu um erro durante o processo: "+i,tipo:"Erro",botao:"Fechar"})})},complete:function(){$("#tabelaDados").sedDataTable({sScrollX:"100%",sScrollXInner:"120%"});AutoCompeltarAluno();$(".formEdicao").validate({rules:{DataOcorrencia:{required:!0,dataValida:!0},CodigoTipoOcorrencia:{required:!0},DescricaoOcorrencia:{required:!0},CodigoPerfilLimite:{required:!0}},messages:{DataOcorrencia:{required:"Obrigatório",dataValida:"Data inválida"},CodigoTipoOcorrencia:{required:"Obrigatório"},DescricaoOcorrencia:{required:"Obrigatório"},CodigoPerfilLimite:{required:"Obrigatório"}}});$("#btnEditarOcorrencia").click(function(n){if(n.preventDefault(),$(".formEdicao").valid()!=!1){if($("#tabelaDados tbody tr").length==undefined){Mensagem.Alert({mensagem:"Nenhum aluno informado.",tipo:"Aviso",botao:"Fechar"});return}if($("#tabelaDados tbody tr").length<=0){Mensagem.Alert({mensagem:"Nenhum aluno informado.",tipo:"Aviso",botao:"Fechar"});return}EditarOcorrencia()}})}})},EditarOcorrencia=function(){var n=$("#CodigoOcorrencia").val(),t=$("#tabelaDados tbody tr"),i=new Array(t.length);$(t).each(function(n){codigoAlunoGrid=$(this).find('input[name="hdfCodigoAluno"]').val();codigoTurmaGrid=$(this).find('input[name="hdfCodigoTurma"]').val();i[n]=codigoAlunoGrid+"|"+codigoTurmaGrid});$.ajax({cache:!1,url:"/Ocorrencia/EditarOcorrencia",type:"POST",datatype:"json",data:{codigoOcorrencia:TratarValorNumerico(n),cpfProfessor:$("#CpfProfessorEdt").val(),codigoTipoOcorrencia:TratarValorNumerico($("#CodigoTipoOcorrencia").val()),descricaoOcorrencia:$("#DescricaoOcorrencia").val(),codigoAbrangencia:TratarValorNumerico($("#CodigoPerfilLimite").val()),listaAluno:i},traditional:!0,success:function(){DetalharOcorrencia(TratarValorNumerico(n))},error:function(n,t,i){$(document).ajaxStop(function(){Mensagem.Alert({titulo:"Erro",mensagem:"Ocorreu um erro durante o processo: "+i,tipo:"Erro",botao:"Fechar"})})}})},PesquisarOcorrencias=function(){var n=TratarValorNumerico($("#txtAnoLetivo").val()),f=TratarValorNumerico($("#CodigoDiretoria").val()),e=TratarValorNumerico($("#CodigoEscola").val()),o=TratarValorNumerico($("#CodigoTipoEnsino").val()),s=TratarValorNumerico($("#CodigoTurma").val()),h=$("#CpfProfessor").val(),t=$("#txtNomeAluno").val(),i=$("#txtRaAluno").val(),c=$("#txtDigRa").val(),r=$("#txtUfRa").val(),u;t==""&&(i==""||r=="")||n<=0?(u="Preencha um dos filtros obrigatórios.",Mensagem.Alert({titulo:"Aviso",mensagem:u,tipo:"Aviso",botao:"Fechar"})):CarregarPesquisaOcorrencias(n,f,e,o,s,h,t,i,c,r)},CarregarPesquisaOcorrencias=function(n,t,i,r,u,f,e,o,s,h){$.ajax({cache:!1,url:"/Ocorrencia/ConsultaOcorrenciaParcial",type:"POST",datatype:"html",data:{anoLetivo:parseInt(n),codigoDiretoria:parseInt(t),codigoEscola:parseInt(i),codigoTipoEnsino:parseInt(r),codigoTurma:parseInt(u),cpf:f,nomeAluno:e,ra:o,digRa:s,ufRa:h},success:function(n){$("#dadosOcorrencias").html(n);$("#tabelaDadosAlunos").sedDataTable({sScrollX:"100%",sScrollXInner:"120%"})},error:function(n,t,i){$(document).ajaxStop(function(){Mensagem.Alert({titulo:"Erro",mensagem:"Ocorreu um erro durante o processo: "+i,tipo:"Erro",botao:"Fechar"})})}})};AtualizarInformacaoAluno=function(){AnoLetivo=$("#txtAnoLetivo").val();$.ajax({cache:!1,url:"/Ocorrencia/AtualizarInformacaoAluno",type:"POST",datatype:"html",data:{anoLetivo:parseInt(AnoLetivo)},success:function(n){$("#dadosTurma").html(n);$("#tabelaDadosAlunos").sedDataTable()},error:function(n,t,i){$(document).ajaxStop(function(){Mensagem.Alert({titulo:"Erro",mensagem:"Ocorreu um erro durante o processo: "+i,tipo:"Erro",botao:"Fechar"})})}})};AutoCompletarEscolaPorAnoLetivo=function(n,t){$(n).focus(function(){textoAnterior=$(this).val()});$(n).blur(function(){$(this).val()!=textoAnterior&&ConsultaEscolaPorAnoLetivo(n,t)})};
/*
//# sourceMappingURL=Ocorrencia.min.js.map
*/